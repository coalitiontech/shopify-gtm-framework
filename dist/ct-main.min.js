function ct_init_gtm_shopify(){let s,i={storefront_token:"",currency:"USD",shop_url:window.location.protocol+"//"+window.location.host,searchPagePath:"/search",template:"",customer:"",collectionTitle:"",productDetails:"",...window.ct_gtm_settings};if(void 0===i.storefront_token||"string"!=typeof i.storefront_token&&""!==i.storefront_token)console.error("You must provide a storefront token");else{window.dataLayer=window.dataLayer||[];let t=["https://cdnjs.cloudflare.com/ajax/libs/xhook/1.4.9/xhook.min.js"];window.jQuery||(t=["https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js","https://cdnjs.cloudflare.com/ajax/libs/xhook/1.4.9/xhook.min.js"]),i.customer&&"object"==typeof i.customer&&gtmEcomm.identifyCustomer(i.customer),new function(t,e){let o=this;o.files=t,o.js=[],o.head=document.getElementsByTagName("head")[0],o.after=e||function(){},o.loadStyle=function(t){let e=document.createElement("link");e.rel="stylesheet",e.type="text/css",e.href=t,o.head.appendChild(e)},o.loadScript=function(t){let e=document.createElement("script");e.type="text/javascript",e.src=o.js[t];e.onload=function(){++t<o.js.length?o.loadScript(t):o.after()},o.head.appendChild(e)};for(let t=0;t<o.files.length;t++)/\.js$|\.js\?/.test(o.files[t])&&o.js.push(o.files[t]),/\.css$|\.css\?/.test(o.files[t])&&o.loadStyle(o.files[t]);0<o.js.length?o.loadScript(0):o.after()}(t,function(){if(jQuery.getJSON(i.shop_url+"/cart",function(t){s={products:t.items.map(function(t){return{id:t.id,quantity:t.quantity}})},sessionStorage.getItem("ct-cart-contents")?c(s,JSON.parse(atob(sessionStorage.getItem("ct-cart-contents")))):sessionStorage.setItem("ct-cart-contents",btoa(JSON.stringify(s)))}),document.location.pathname===i.searchPagePath&&dataLayer.push({event:"search",pageType:"Search Results",searchTerm:function(t,e){e=e||window.location.href,t=t.replace(/[\[\]]/g,"\\$&");let o=new RegExp("[?&]"+t+"(=([^&#]*)|&|#|$)"),r=o.exec(e);return r?r[2]?decodeURIComponent(r[2].replace(/\+/g," ")):"":null}("q")}),document.querySelectorAll('a[href*="/products/"]').length){let e=[],o={},t=[];for(var n in[].forEach.call(document.querySelectorAll('a[href*="/products/"]'),function(t){o[t.getAttribute("href")]=t}),o){n=o[n].getAttribute("href").split(/[?#]/)[0].split("/"),n=n[n.length-1],n=$.ajax({url:i.shop_url+`/products/${n}.json`,success:function(t){t=t.product.variants[0].id||t.product.id;e.push(t)}});t.push(n)}let r={};""!==i.collectionTitle&&"string"==typeof i.collectionTitle&&(r={list:i.collectionTitle}),$.when.apply(null,t).done(function(){gtmEcomm.productImpression(e,r)})}function c(r,n=s){if(n.products.length!==r.products.length)if(n.products.length<r.products.length){var e=r.products.reduce((t,e,o)=>(n.products.some(t=>t.id===e.id)||t.push(o),t),[]);for(let t=0;t<e.length;t++)gtmEcomm.addToCart(r.products[e[t]].id,r.products[e[t]].quantity)}else{var o=n.products.reduce((t,e,o)=>(r.products.some(t=>t.id===e.id)||t.push(o),t),[]);for(let t=0;t<o.length;t++)gtmEcomm.removeFromCart(n.products[o[t]].id,n.products[o[t]].quantity)}for(let t=0;t<r.products.length;t++)n.products.length===r.products.length&&r.products[t].quantity!==n.products[t].quantity&&(n.products[t].quantity<r.products[t].quantity?gtmEcomm.addToCart(r.products[t].id,r.products[t].quantity-n.products[t].quantity):n.products[t].quantity>r.products[t].quantity&&gtmEcomm.removeFromCart(r.products[t].id,n.products[t].quantity-r.products[t].quantity));sessionStorage.setItem("ct-cart-contents",btoa(JSON.stringify(r)))}$('a[href*="/products/"]').click(function(){var t=$(this).attr("href").split(/[?#]/)[0].split("/"),t=t[t.length-1];$.ajax({url:i.shop_url+`/products/${t}.json`,success:function(t){gtmEcomm.productClick(t.product.id)}})}),i.template.match(/.*product.*/gi)&&!i.template.match(/.*collection.*/gi)&&"string"==typeof i.productDetails&&""!==i.productDetails&&gtmEcomm.viewProductDetails(i.productDetails),window.Shopify&&window.Shopify.Checkout&&"thank_you"==window.Shopify.Checkout.step&&gtmEcomm.purchase(window.CHECKOUT_FOR_GTM_INSTRUMENTOR),xhook.after(function(t,e){let o=String(e.url),r=String(t.finalUrl),n=String(t.url);(o.includes(window.routes.cart_add_url)||o.includes(window.routes.cart_change_url)||o.includes(window.routes.cart_update_url)||r.includes(window.routes.cart_add_url)||r.includes(window.routes.cart_change_url)||r.includes(window.routes.cart_update_url)||n.includes(window.routes.cart_add_url)||n.includes(window.routes.cart_change_url)||n.includes(window.routes.cart_update_url))&&jQuery.getJSON(i.shop_url+"/cart",function(t){c({products:t.items.map(function(t){return{id:t.id,quantity:t.quantity}})})})})})}}document.addEventListener("DOMContentLoaded",ct_init_gtm_shopify);