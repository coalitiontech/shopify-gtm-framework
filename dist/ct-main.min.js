function ct_init_gtm_shopify(){let n,i={storefront_token:"",currency:"USD",shop_url:window.location.protocol+"//"+window.location.host,searchPagePath:"/search",template:"",customer:"",collectionTitle:"",productDetails:"",...window.ct_gtm_settings};if(void 0===i.storefront_token||"string"!=typeof i.storefront_token&&""!==i.storefront_token)console.error("You must provide a storefront token");else{window.dataLayer=window.dataLayer||[];let t=["https://cdnjs.cloudflare.com/ajax/libs/xhook/1.4.9/xhook.min.js"];window.jQuery||(t=["https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js","https://cdnjs.cloudflare.com/ajax/libs/xhook/1.4.9/xhook.min.js"]),i.customer&&"object"==typeof i.customer&&gtmEcomm.identifyCustomer(i.customer),new function(t,e){let o=this;o.files=t,o.js=[],o.head=document.getElementsByTagName("head")[0],o.after=e||function(){},o.loadStyle=function(t){let e=document.createElement("link");e.rel="stylesheet",e.type="text/css",e.href=t,o.head.appendChild(e)},o.loadScript=function(t){let e=document.createElement("script");e.type="text/javascript",e.src=o.js[t];e.onload=function(){++t<o.js.length?o.loadScript(t):o.after()},o.head.appendChild(e)};for(let t=0;t<o.files.length;t++)/\.js$|\.js\?/.test(o.files[t])&&o.js.push(o.files[t]),/\.css$|\.css\?/.test(o.files[t])&&o.loadStyle(o.files[t]);0<o.js.length?o.loadScript(0):o.after()}(t,function(){if(jQuery.getJSON(i.shop_url+"/cart",function(t){n={products:t.items.map(function(t){return{id:t.id,quantity:t.quantity}})}}),document.location.pathname===i.searchPagePath&&dataLayer.push({event:"search",pageType:"Search Results",searchTerm:function(t,e){e=e||window.location.href,t=t.replace(/[\[\]]/g,"\\$&");let o=new RegExp("[?&]"+t+"(=([^&#]*)|&|#|$)"),r=o.exec(e);return r?r[2]?decodeURIComponent(r[2].replace(/\+/g," ")):"":null}("q")}),document.querySelectorAll('a[href*="/products/"]').length){let e=[],o={},t=[];for(var c in[].forEach.call(document.querySelectorAll('a[href*="/products/"]'),function(t){o[t.getAttribute("href")]=t}),o){c=o[c].getAttribute("href").split(/[?#]/)[0].split("/"),c=c[c.length-1],c=$.ajax({url:i.shop_url+`/products/${c}.json`,success:function(t){t=t.product.variants[0].id||t.product.id;e.push(t)}});t.push(c)}let r={};""!==i.collectionTitle&&"string"==typeof i.collectionTitle&&(r={list:i.collectionTitle}),$.when.apply(null,t).done(function(){gtmEcomm.productImpression(e,r)})}$('a[href*="/products/"]').click(function(){var t=$(this).attr("href").split(/[?#]/)[0].split("/"),t=t[t.length-1];$.ajax({url:i.shop_url+`/products/${t}.json`,success:function(t){gtmEcomm.productClick(t.product.id)}})}),i.template.match(/.*product.*/gi)&&!i.template.match(/.*collection.*/gi)&&"string"==typeof i.productDetails&&""!==i.productDetails&&gtmEcomm.viewProductDetails(i.productDetails),window.Shopify&&window.Shopify.Checkout&&"thank_you"==window.Shopify.Checkout.step&&gtmEcomm.purchase(window.CHECKOUT_FOR_GTM_INSTRUMENTOR),xhook.after(function(t,e){let o=String(e.url);(o.includes(window.routes.cart_add_url)||o.includes(window.routes.cart_change_url)||o.includes(window.routes.cart_update_url))&&jQuery.getJSON(i.shop_url+"/cart",function(t){let r=n,c={products:t.items.map(function(t){return{id:t.id,quantity:t.quantity}})};if(r.products.length!==c.products.length)if(r.products.length<c.products.length){var e=c.products.reduce((t,e,o)=>(r.products.some(t=>t.id===e.id)||t.push(o),t),[]);for(let t=0;t<e.length;t++)gtmEcomm.addToCart(c.products[e[t]].id,c.products[e[t]].quantity)}else{var o=r.products.reduce((t,e,o)=>(c.products.some(t=>t.id===e.id)||t.push(o),t),[]);for(let t=0;t<o.length;t++)gtmEcomm.removeFromCart(r.products[o[t]].id,r.products[o[t]].quantity)}for(let t=0;t<c.products.length;t++)r.products.length===c.products.length&&c.products[t].quantity!==r.products[t].quantity&&(r.products[t].quantity<c.products[t].quantity?gtmEcomm.addToCart(c.products[t].id,c.products[t].quantity-r.products[t].quantity):r.products[t].quantity>c.products[t].quantity&&gtmEcomm.removeFromCart(c.products[t].id,r.products[t].quantity-c.products[t].quantity));n={products:t.items.map(function(t){return{id:t.id,quantity:t.quantity}})}})})})}}document.addEventListener("DOMContentLoaded",ct_init_gtm_shopify);